# 4. 相机位置与文字切屏

## 1. 相机位置转换

鼠标滚轴滚动,需要:

- 变换文字内容
- 旋转的中心点
- 改变相机位置

```javascript
let scenes = [
    {
        // 切换场景时显示的文字内容
        text: "文本内容1",
        // 切换场景时执行的回调函数 用于改变相机位置
        callback: () => {
            const cameraPosition = new THREE.Vector3(-3.23, 3, 4.06)
            const controlTarget = new THREE.Vector3(-8, 2, 0)
            moveCamera(cameraPosition, controlTarget)
        },
    },
    {
        text: "文本内容2",
        callback: () => {
            const cameraPosition = new THREE.Vector3(7, 0, 23)
            const controlTarget = new THREE.Vector3(0, 0, 0)
            moveCamera(cameraPosition, controlTarget)
        },
    },
    {
        text: "文本内容3",
        callback: () => {
            const cameraPosition = new THREE.Vector3(10, 3, 0)
            const controlTarget = new THREE.Vector3(5, 2, 0)
            moveCamera(cameraPosition, controlTarget)
        },
    },
    {
        text: "文本内容4",
        callback: () => {
            const cameraPosition = new THREE.Vector3(7, 0, 23)
            const controlTarget = new THREE.Vector3(0, 0, 0)
            moveCamera(cameraPosition, controlTarget)
        },
    },
    {
        text: "文本内容5",
        callback: () => {
            const cameraPosition = new THREE.Vector3(-20, 1.3, 6.6)
            const controlTarget = new THREE.Vector3(5, 2, 0)
            moveCamera(cameraPosition, controlTarget)
        },
    },
]

let sceneIndex = ref(0)

// wheel: 监听鼠标滚轮事件
window.addEventListener("wheel", wheelHandler)

// 正在播放动画的标记位
let isAnimating = false

function wheelHandler(event) {
    if (isAnimating) {
        return
    }

    isAnimating = true

    // event.deltaY: 鼠标滚轮向下滚时为正 向上滚时为负
    if (event.deltaY > 0) {
        sceneIndex.value++
    }

    if (sceneIndex.value > scenes.length - 1) {
        sceneIndex.value = 0
    }

    scenes[sceneIndex.value].callback()

    // 1秒后允许再次触发动画
    setTimeout(() => {
        isAnimating = false
    }, 1000)
}

// timeline: 用于组合多个补间动画
// 移动相机位置的补间动画时间线
const cameraPositionTimeline = gsap.timeline()
// 移动旋转中心位置的补间动画时间线
const controlTargetTimeline = gsap.timeline()

/**
 * 本函数用于移动相机到指定位置并修改旋转中心位置
 * @param {THREE.Vector3} position - 相机目标位置
 * @param {THREE.Vector3} target - 旋转中心位置
 * */
function moveCamera(position, target) {
    cameraPositionTimeline.to(camera.position, {
        x: position.x,
        y: position.y,
        z: position.z,
        duration: 1,
        ease: "power2.inOut",
    })

    // 注意: 控制旋转中心是controls.target 而不是camera.lookAt
    // 所以要修改controls.target的点位
    controlTargetTimeline.to(controls.target, {
        x: target.x,
        y: target.y,
        z: target.z,
        duration: 1,
        ease: "power2.inOut",
    })
}
```

- `gsap.timeline`: 用于创建时间线对象,可以将多个补间动画组合在一起
  - 这里要注意移动相机位置和改变旋转中心这2个动画是同时进行的,二者之间没有先后关系,所以创建了2个时间线对象
- `event.deltaY`: 鼠标滚轮滚动的距离,向下滚时为正,向上滚时为负
- `controls.target`: 控制器的旋转中心位置,不是`camera.lookAt`
- 时间处理函数中的`setTimeout`: 用于防止鼠标滚轮滚动过快导致动画错乱,在动画播放期间禁止再次触发动画

注意设置控制器的初始旋转中心:

```javascript
// 初始化控制器
const controls = new OrbitControls(camera, renderer.domElement)
// 开启阻尼效果
controls.enableDamping = true
// 设置控制器的旋转中心点
controls.target.set(-8, 2, 0)
```

## 2. 文字切屏

核心原理: 把每个文本分别放在一个高为1个屏幕的div里,然后为这些div设置一个父元素,滚动时切换父元素的`transform: translateY`属性即可

```vue
<template>
    <div class="content" :style="{transform: `translate3d(0, -${sceneIndex * 100}vh, 0)`}">
        <!-- 这里每个contentItem都是100vh的 所以鼠标滚动事件触发时 只需要修改父元素的transform属性,上/下移一个屏幕的高度即可 -->
        <div v-for="scene in scenes" :key="scene.text" class="contentItem">
            <h1>{{scene.text}}</h1>
        </div>
    </div>
</template>


<style>
    .content {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 10;
        /*
        由于该盒子背后的canvas元素上有鼠标滚轮事件的监听 所以设置盒子的鼠标事件失效
         */
        pointer-events: none;
        transition: all 1s;
    }

    .contentItem {
        width: 100vw;
        height: 100vh;
    }

    .contentItem h1 {
        padding: 100px;
        font-size: 50px;
        color: white;
    }
</style>
```
